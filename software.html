<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

        <meta name="description" content="Balão estratosférico ESIC - Software">
        <title>Software | Balão estratosférico ESIC</title>

        <link rel="stylesheet" href="style.css">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,700italic,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css">
        <script src="main.js"></script>
    </head>
    <body>
        <header>
            <a href="./index.html">Balão estratosférico ESIC</a>
            <div class="spacer"></div>
            <a href="./about.html">Sobre o projeto</a>
            <a href="./about-us.html">Sobre nós</a>
            <a href="./capsule.html">Construção</a>
            <a href="./software.html">Software</a>
            <a href="./data.html">Dados</a>
            <div id="drawer-button"><i class="fa fa-bars fa-lg"></i></div>
        </header>

        <div id="drawer">
            <a href="./about.html">Sobre o projeto</a>
            <a href="./about-us.html">Sobre nós</a>
            <a href="./capsule.html">Construção</a>
            <a href="./software.html">Software</a>
            <a href="./data.html">Dados</a>
        </div>

        <div class="card page">
            <div class="info-section">
                <h1>Desenvolvimento do software</h1>
                <p>
                    Todo o software desenvolvido por nós é Open Source está disponível na <a target="_blank" href="https://github.com/weirdNox/BEESIC">nossa página do Github</a>.
                </p>
                <h3>Computador de bordo - Comunicação</h3>
                <div class="parallax">
                    <img src="https://cloud.githubusercontent.com/assets/11081628/15297693/60b7e6f6-1b93-11e6-98da-ece329cde470.jpg">
                </div>
                <p>
                    Antes de qualquer trabalho ser feito no Raspberry Pi 2 (RasPi), houve diversos problemas em simplesmente estabelecer a ligação entre o computador de trabalho e o RasPi. Este tem 2 saídas de vídeo, HDMI e vídeo composto analógico, e
                    o monitor do computador de trabalho apenas tem entrada VGA. Testámos várias alternativas diferentes até conseguirmos programá-lo de forma estável e eficiente.
                </p>
                <div class="info-section">
                    <h5>Usar adaptador HDMI-VGA <i class="fa fa-times" aria-hidden="true"></i></h5>
                    <p>
                        Esta solução foi rapidamente descartada, uma vez que o adaptador não funcionava corretamente (e mesmo que funcionasse, teríamos de programar diretamente no RasPi,
                        o que tornava o processo lento e isso não era desejado).
                    </p>
                </div>
                <div class="info-section">
                    <h5>Ligar por rede usando SSH (secure shell) <i class="fa fa-times" aria-hidden="true"></i></h5>
                    <p>
                        Esta alternativa parecia a mais correta a seguir mas quando já se preparava a ligação por SSH, percebemos duas coisas:
                        <ol>
                            <li>
                                Sem monitor ligado ao RasPi, não havia maneira fácil de saber o IP address para fazer a ligação. Ainda assim, pensámos em usar ARP, ver os DHCP requests
                                ou simplesmente ver no router qual o IP, o que nos leva ao ponto seguinte
                            </li>
                            <li>
                                Na escola existe uma firewall empresarial a estragar-nos os planos! No entanto não desistimos e depois de algumas dores de cabeça,
                                chegámos a outra alternativa
                            </li>
                        </ol>
                    </p>
                </div>
                <div class="info-section">
                    <h5>Fazer ligação ethernet direta ao computador principal <i class="fa fa-check" aria-hidden="true"></i></h5>
                    <p>
                        Depois de alguma pesquisa, <a target="_blank" href="https://pihw.wordpress.com/guides/direct-network-connection/">chegámos a este site</a> que nos explica como ligar diretamente
                        o computador principal ao RasPi! E, para além de já ser uma boa solução assim só, ainda tivemos um bónus: como o computador estava ligado por wifi à rede, pudemos
                        partilhar essa ligação e ter internet no RasPi.
                    </p>
                </div>
                <p>Quando finalmente tivemos uma maneira eficaz de comunicar com o computador de bordo, pudemos começar a programar!</p>
            </div>
            <div class="info-section">
                <h3>Computador de bordo - Configuração do Linux e bases</h3>
                <div class="parallax">
                    <img src="https://cloud.githubusercontent.com/assets/11081628/15315191/00977acc-1c0e-11e6-8f3f-c61d1a28bdf8.jpg">
                </div>
                <p>
                    Para esta parte é sempre preciso um bocadinho de magia negra! Usámos a distribuição Jessie Lite do Raspbian e apenas instalámos os mínimos para se obter ganhos no consumo de energia.
                    Seguidamente, tivemos de configurar tudo! Usámos o systemd para iniciar o nosso programa mal o RasPi iniciasse e configurámos o NTP (Network Time Protocol) para
                    não tentar ir buscar as horas a lado nenhum pois não há internet na estratosfera (e se não fizéssemos isto, iríamos ter horas bem configuradas durante os testes pois tínhamos internet).
                    Também ativámos o watchdog para fazer restart do RasPi na eventualidade de ele bloquear.
                </p>
                <ul>
                    Algumas ferramentas que tivemos de instalar:
                    <li>gpsd</li>
                    <li>gpsd-clients</li>
                    <li>python-gps</li>
                    <li>espeak</li>
                    <li>watchdog</li>
                </ul>
                <p>
                    Depois de termos o sistema operativo configurado, começámos a trabalhar no nosso programa. Começámos por fazer um sistema de logging para podermos saber de tudo caso alguma coisa falhasse
                    e depois começámos a pensar em maneiras de conseguir perceber o que se está a passar no RasPi sem termos contacto direto (no lançamento não há monitores nem ligação ethernet para ninguém!).
                    Chegámos à conclusão que, uma vez que vamos ter transmissão de vídeo em direto, podíamos usar a faixa de áudio para comunicar! E como? Com um speech synthesizer! Sim, temos um
                    <span class="emph">sintetizador de voz</span> que comunica eventuais erros que aconteçam e, para além disso, está constantemente a <span class="emph">dizer as coordenadas provenientes do
                    GPS!</span> Assim, na altura do lançamento, sabemos quais são os sitemas que falharam e os que iniciaram e podemos simplesmente ouvir as coordenadas para não estarmos sempre a ler.
                </p>
            </div>
            <div class="info-section">
                <h3>Computador de bordo - Sensores de temperatura e pressão</h3>
                <div class="parallax">
                    <img src="https://cloud.githubusercontent.com/assets/11081628/15297694/60b90d6a-1b93-11e6-8402-80a98042da64.jpg">
                </div>
                <p>
                    A ligação ao sensor de temperatura/pressão foi fácil de fazer apesar de termos um problema inicial. Utilizámos o BMP180 e como ele ainda não estava soldado,
                    a ligação falhava às vezes, mas quando percebemos que era esse o problema, foi uma questão de adicionar o código de leitura do sensor ao script principal.
                </p>
            </div>
            <div class="info-section">
                <h3>Computador de bordo - Câmara digital</h3>
                <div class="parallax">
                    <img src="https://cloud.githubusercontent.com/assets/11081628/15297862/41b1e008-1b94-11e6-95ad-806b97e14956.jpg">
                </div>
                <p>
                    Apesar de termos uma câmara analógica para transmissão de vídeo em direto, também temos uma câmara digital ligada ao RasPi para gravarmos o vídeo da viagem.
                    Esta parte também foi muito simples de fazer, uma vez que apenas usámos a câmara oficial do RasPi. Criámos uma thread que grava vídeos para o
                    cartão de memória regularmente e ficou a funcionar.
                </p>
                <p>
                    Uma parte engraçada da câmara é a luzinha que ela tem quando está a gravar. Depois de olharmos para isso, pensámos "Ela tem de ir desligada para não fazer reflexo no vidro, e já agora
                    podíamos aproveitar e fazer alguma coisa com ela..."; e foi precisamente isso que fizemos! Quando o RasPi liga, para termos mais um fator de confirmação, a luz pisca 5x e depois
                    desliga-se. Assim sabemos quando o RasPi começa a correr o nosso software!
                </p>
            </div>
            <div class="info-section">
                <h3>Computador de bordo - GPS</h3>
                <div class="parallax">
                    <img src="https://cloud.githubusercontent.com/assets/11081628/15297863/41cd4f00-1b94-11e6-907d-794c32d33ea4.jpg">
                </div>
                <p>
                    Esta parte foi a mais difícil porque estávamos a ter erros aleatórios sem os conseguirmos reproduzir e muito estranhos. Depois, de muitas tentativas e erros,
                    descobrimos que o nosso GPS estava localizado no /dev/ttyACM0 e usámos essa localização para inicar o gpsd. Também descobrimos que por vezes tínhamos de
                    reiniciar o sistema de GPS e por isso adicionámos lógica para fazer isso regularmente.
                </p>
                <p>
                    Finalmente, para sincronizar as horas com o relógio do GPS usámos várias alternativas. Começámos por usar o NTP, pois este supostamente tem em conta os delays e corrige
                    a hora, mas acabámos por usar uma simples configuração manual das horas no código, porque o NTP estava cheio de problemas e mais de metade das vezes não funcionava.
                </p>
                <p>
                    Como uma imagem vale mais que mil palavras, então o código utilizado é muito melhor para descrever a solução utilizada, por isso <a target="_blank" href="https://github.com/weirdNox/BEESIC/tree/master/sky/scripts">dêem uma vista de olhos</a>!
                </p>
                <p>
                    Momento engraçado: tivemos de reduzir o cabo do GPS para não ficar tanto cabo no meio da caixa... e por momentos pensámos que tínhamos estragado tudo! Dentro do cabo USB
                    há 4 cabos mais pequenos e, ao soldar duas pontas de dois cabos diferentes, estava a ficar um desastre! A solução foi soldar à parte metálica final diretamente e não
                    soldar as duas pontas de dois cabos.
                </p>
            </div>
            <div class="info-section">
                <h3>Website</h3>
                <div class="parallax">
                    <img src="https://cloud.githubusercontent.com/assets/11081628/15299807/cef490d8-1b9d-11e6-836c-b3b1bca9653d.png">
                </div>
                <p>
                    E para finalizar, ainda tivemos de fazer este site para o projeto! O interessante é que, como queríamos fazer um projeto 100% desenvolvido por nós, foi precisamente isso que fizemos:
                    <span class="emph">não usámos framework nenhuma e desenvolvemos tudo de raiz!</span> E sim!, este site também é Open Source como o resto do projeto e
                    <a target="_blank" href="https://github.com/weirdNox/BEESIC/tree/gh-pages">está disponível no branch gh-pages do nosso repositório</a>.
                </p>
                <p>
                    Para além de ter sido feito todo por nós, foi feito num curto espaço de tempo! Como podem verificar no
                    <a target="_blank" href="https://github.com/weirdNox/BEESIC/commits/gh-pages">log do repositório</a>, começou a ser desenvolvido a 5 de maio e tinha de estar pronto
                    a tempo do lançamento (20 de maio)! É a cereja no topo do bolo deste projeto!
                </p>
            </div>
        </div>

        <div id="footer">
            <div id="links">
                Segue-nos! <a href="https://github.com/weirdnox/BEESIC" target="_blank"><i class="fa fa-github fa-lg"></i></a>
            </div>
            <div id="logos">
                <a href="https://github.com/weirdnox/BEESIC" target="_blank"><img src="https://opensource.org/files/osi_standard_logo.png"></a>
                <a href="http://www.esic.pt" target="_blank"><img src="http://www2.nonio.uminho.pt/inescastro/file.php/1/outros/logo_esic.jpg"></a>
                <a href="https://sigarra.up.pt/feup/pt/web_page.inicial" target="_blank"><img src="https://sigarra.up.pt/feup/pt/WEB_GESSI_DOCS.download_file?p_name=F-881455704/feup_logo.jpg"></a>
            </div>
        </div>

        <div id="obfuscator"></div>
    </body>
</html>
